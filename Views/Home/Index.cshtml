<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

<div class="text-center">
    <h1 class="display-4">SmartStall</h1>
</div>
<br />
<br />
<div class="custom-control custom-switch text-right">
    <input type="checkbox" class="custom-control-input" id="customSwitch1">
    <label class="custom-control-label" for="customSwitch1">Benachrichtigung</label>
</div>
<div class="custom-control custom-switch container text-right">
    <input type="checkbox" class="custom-control-input" id="customSwitch2">
    <label class="custom-control-label" for="customSwitch2">Belüftung &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
</div>
<!----------------------------------------Ammoniak----------------------------------------------->
<div>
    <h2>Ammoniak</h2>
    <div class="chart-container">
        <div class="current-value-box-ammoniak">
            <p style="text-align: center; font-weight: bold;">Aktueller Wert:</p>
            <p id="currentValueAmmoniak" style="text-align: center; font-weight: bold;">13</p>
        </div>
    </div>
    <div class="btn-group" role="group" aria-label="Chart View">
        <button id="wocheBtnAmmoniak" type="button" class="btn btn-secondary">Woche</button>
        <button id="tagBtnAmmoniak" type="button" class="btn btn-secondary active">Tag</button>
    </div>
    <canvas id="lineChartAmmoniak"></canvas>
</div>

<!----------------------------------------Luftfeuchtigkeit----------------------------------------------->
<br />
<br />
<br />
<br />
<div>
    <h2>Luftfeuchtigkeit</h2>
    <div class="chart-container">
        <div class="current-value-box-luftfeuchtigkeit">
            <p style="text-align: center; font-weight: bold;">Aktueller Wert:</p>
            <p id="currentValueLuftfeuchtigkeit" style="text-align: center; font-weight: bold;">13</p>
        </div>
    </div>
    <div class="btn-group" role="group" aria-label="Chart View">
        <button id="wocheBtnLuftfeuchtigkeit" type="button" class="btn btn-secondary">Woche</button>
        <button id="tagBtnLuftfeuchtigkeit" type="button" class="btn btn-secondary active">Tag</button>
    </div>
    <canvas id="lineChartLuftfeuchtigkeit"></canvas>
</div>

<!----------------------------------------Temperatur----------------------------------------------->
<br />
<br />
<br />
<br />
<div>
    <h2>Temperatur</h2>
    <div class="chart-container">
        <div class="current-value-box-temperatur">
            <p style="text-align: center; font-weight: bold;">Aktueller Wert:</p>
            <p id="currentValueTemperatur" style="text-align: center; font-weight: bold;">13</p>
        </div>
    </div>
    <div class="btn-group" role="group" aria-label="Chart View">
        <button id="wocheBtnTemperatur" type="button" class="btn btn-secondary">Woche</button>
        <button id="tagBtnTemperatur" type="button" class="btn btn-secondary active">Tag</button>
    </div>
    <canvas id="lineChartTemperatur"></canvas>
</div>

<!---------------------------------------------------------------------------------------------->
<br />
<br />
<br />
<br />

<style>
    .current-value-box-temperatur {
        border: 1px solid black;
        padding: 10px;
        margin-right: 10px;
        float: right;
        width: 140px;
        height:90px;
    }

    .current-value-box-luftfeuchtigkeit {
        border: 1px solid black;
        padding: 10px;
        margin-right: 10px;
        float: right;
        width: 140px;
        height: 90px;
    }

    .current-value-box-ammoniak {
        border: 1px solid black;
        padding: 10px;
        margin-right: 10px;
        float: right;
        width: 140px;
        height: 90px;
    }
</style>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
@*<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>*@

<script>
    var lineChartAmmoniak;
    var optionsAmmoniak;
    var dataAmmoniak;

    var lineChartLuftfeuchtigkeit;
    var optionsLuftfeuchtigkeit;
    var dataLuftfeuchtigkeit;

    var lineChartTemperatur;
    var optionsTemperatur;
    var dataTemperatur;
    
    document.getElementById("currentValueAmmoniak").innerHTML = @Html.Raw(ViewBag.aktuellerWertAmmoniak);
    document.getElementById("currentValueLuftfeuchtigkeit").innerHTML = @Html.Raw(ViewBag.aktuellerWertLuftfeuchtigkeit);
    document.getElementById("currentValueTemperatur").innerHTML = @Html.Raw(ViewBag.aktuellerWertTemperatur);

    checkeAktuelleWerte();

    buildDiagramms();
    setInterval(aktualisiereView, 60000);

    document.getElementById("tagBtnAmmoniak").addEventListener("click", function () {
        optionsAmmoniak.scales.x.min = 0;
        optionsAmmoniak.scales.x.max = 23;
        optionsAmmoniak.scales.x.title.text = 'Uhrzeit';

        $.ajax({
            url: "/Home/GetAmmoniak", // Die URL des Controller-Endpunkts, um die aktualisierten Daten abzurufen
            type: "GET",
            success: function (ammoniakData) {

                lineChartAmmoniak.data.datasets[0].data = JSON.parse(ammoniakData["AmmoniakAktuellListeTag"]); //Aktuell

                // Diagramm neu zeichnen
                lineChartAmmoniak.update();
            },
            error: function (xhr, status, error) {
                console.log("Fehler beim Abrufen der Ammoniakdaten:", error);
            }
        });

        lineChartAmmoniak.update();
    });

        document.getElementById("tagBtnLuftfeuchtigkeit").addEventListener("click", function () {
            optionsLuftfeuchtigkeit.scales.x.min = 0;
            optionsLuftfeuchtigkeit.scales.x.max = 23;
            optionsLuftfeuchtigkeit.scales.x.title.text = 'Uhrzeit';

            $.ajax({
                url: "/Home/GetLuftfeuchtigkeit", // Die URL des Controller-Endpunkts, um die aktualisierten Daten abzurufen
                type: "GET",
                success: function (luftfeuchtigkeitData) {

                    lineChartLuftfeuchtigkeit.data.datasets[0].data = JSON.parse(luftfeuchtigkeitData["luftfeuchtigkeitWerteTagAktuell"]); //Aktuell

                    // Diagramm neu zeichnen
                    lineChartLuftfeuchtigkeit.update();
                },
                error: function (xhr, status, error) {
                    console.log("Fehler beim Abrufen der Luftfeuchtigkeitdaten:", error);
                }
            });

            lineChartLuftfeuchtigkeit.update();
        });

    document.getElementById("tagBtnTemperatur").addEventListener("click", function () {
        optionsTemperatur.scales.x.min = 0;
        optionsTemperatur.scales.x.max = 23;
        optionsTemperatur.scales.x.title.text = 'Uhrzeit';

        $.ajax({
            url: "/Home/GetTemperatur", // Die URL des Controller-Endpunkts, um die aktualisierten Daten abzurufen
            type: "GET",
            success: function (temperaturData) {

                lineChartTemperatur.data.datasets[0].data = JSON.parse(temperaturData["temperaturWerteTagAktuell"]);

                // Diagramm neu zeichnen
                lineChartTemperatur.update();
            },
            error: function (xhr, status, error) {
                console.log("Fehler beim Abrufen der Temperaturdaten:", error);
            }
        });

        lineChartTemperatur.update();
    });

        document.getElementById("wocheBtnAmmoniak").addEventListener("click", function () {

            optionsAmmoniak.scales.x.min = 1;
            optionsAmmoniak.scales.x.max = 7;
            optionsAmmoniak.scales.x.title.text = 'Tag in der Woche';

            lineChartAmmoniak.update();

            $.ajax({
                url: "/Home/GetAmmoniak", // Die URL des Controller-Endpunkts, um die aktualisierten Daten abzurufen
                type: "GET",
                success: function (ammoniakData) {

                lineChartAmmoniak.data.datasets[0].data = JSON.parse(ammoniakData["AmmoniakAktuellListeWoche"]); //Aktuell

                    // Diagramm neu zeichnen
                    lineChartAmmoniak.update();
                },
                error: function (xhr, status, error) {
                    console.log("Fehler beim Abrufen der Ammoniakdaten:", error);
                }
            });
        });

        document.getElementById("wocheBtnLuftfeuchtigkeit").addEventListener("click", function () {
            optionsLuftfeuchtigkeit.scales.x.min = 1;
            optionsLuftfeuchtigkeit.scales.x.max = 7;
            optionsLuftfeuchtigkeit.scales.x.title.text = 'Tag in der Woche';

            lineChartLuftfeuchtigkeit.update();

            $.ajax({
                url: "/Home/GetLuftfeuchtigkeit", // Die URL des Controller-Endpunkts, um die aktualisierten Daten abzurufen
                type: "GET",
                success: function (luftfeuchtigkeitData) {

                    lineChartLuftfeuchtigkeit.data.datasets[0].data = JSON.parse(luftfeuchtigkeitData["luftfeuchtigkeitWerteWocheAktuell"]); //Aktuell

                    // Diagramm neu zeichnen
                    lineChartLuftfeuchtigkeit.update();
                },
                error: function (xhr, status, error) {
                    console.log("Fehler beim Abrufen der Luftfeuchtigkeitdaten:", error);
                }
            });
        });

    document.getElementById("wocheBtnTemperatur").addEventListener("click", function () {
        optionsTemperatur.scales.x.min = 1;
        optionsTemperatur.scales.x.max = 7;
        optionsTemperatur.scales.x.title.text = 'Tag in der Woche';

        $.ajax({
            url: "/Home/GetTemperatur", // Die URL des Controller-Endpunkts, um die aktualisierten Daten abzurufen
            type: "GET",
            success: function (temperaturData) {

                lineChartTemperatur.data.datasets[0].data = JSON.parse(temperaturData["temperaturWerteWocheAktuell"]); //Durchschnitt

                // Diagramm neu zeichnen
                lineChartTemperatur.update();
            },
            error: function (xhr, status, error) {
                console.log("Fehler beim Abrufen der Temperaturdaten:", error);
            }
        });

        lineChartTemperatur.update();
    });

        function buildDiagramms() {

            ammoniakDiagramm();
            luftfeuchtigkeitDiagramm()
            temperaturDiagramm()
        }

        function ammoniakDiagramm() {

        var ammoniakWerteTagAktuell = JSON.parse('@Html.Raw(ViewBag.ammoniakWerteTagAktuell)');

        dataAmmoniak = {
            labels: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23'],
            datasets: [
                {
                    label: "Ammoniak-Aktuell",
                    data: ammoniakWerteTagAktuell,
                    fill: true,
                    borderColor: "rgb(13, 13, 13)",
                    tension: 0.2
                },
                {
                    label: "Ammoniakgrenze",
                    data: ["10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10"],
                    fill: true,
                    borderColor: "rgb(240, 2, 2)",
                    tension: 0.1
                }
            ]
        };

        optionsAmmoniak = {
            responsive: true,
            scales: {
                x: {
                    type: 'linear',
                    position: 'bottom',
                    min: 0,
                    max: 23,
                    title: {
                        display: true,
                        text: 'Uhrzeit'
                    },
                    ticks: {
                        autoSkip: false,
                        stepSize: 1,
                        callback: function (value, index, values) {
                            var label = Math.floor(value); // Ganzzahligen Teil extrahieren
                            var decimal = value % 1; // Dezimalteil extrahieren
                            if (decimal !== 0) {
                                label += decimal.toFixed(3).substring(1); // Dezimalzahl anfügen (ohne das führende 0)
                            }
                            return label;
                        }
                    }
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Ammoniakgehalt in ppm'
                    }
                }
            }
        };

        lineChartAmmoniak = new Chart($("#lineChartAmmoniak"), {
            type: "line",
            data: dataAmmoniak,
            options: optionsAmmoniak
        });

    }

    function luftfeuchtigkeitDiagramm() {

        var luftfeuchtigkeitWerteTagAktuell = JSON.parse('@Html.Raw(ViewBag.luftfeuchtigkeitWerteTagAktuell)');

        dataLuftfeuchtigkeit = {
            labels: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23'],
                datasets: [
                    {
                        label: "Luftfeuchtigkeit aktuell",
                        data: luftfeuchtigkeitWerteTagAktuell,
                        fill: false,
                        borderColor: "rgb(13, 13, 13)",
                        tension: 0.2
                    },
                    {
                        label: "Luftfeuchtigkeitgrenze",
                        data: ["10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10", "10"],
                        fill: true,
                        borderColor: "rgb(240, 2, 2)",
                        tension: 0.1
                    }
                ]
            };

        optionsLuftfeuchtigkeit = {
            responsive: true,
            scales: {
                x: {
                    type: 'linear',
                    position: 'bottom',
                    min: 0,
                    max: 23,
                    title: {
                        display: true,
                        text: 'Uhrzeit'
                    },
                    ticks: {
                        autoSkip: false,
                        stepSize: 1,
                        callback: function (value, index, values) {
                            var label = Math.floor(value); // Ganzzahligen Teil extrahieren
                            var decimal = value % 1; // Dezimalteil extrahieren
                            if (decimal !== 0) {
                                label += decimal.toFixed(3).substring(1); // Dezimalzahl anfügen (ohne das führende 0)
                            }
                            return label;
                        }
                    }
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Luftfeuchtigkeit in Prozent'
                    }
                }
            }
            };

        lineChartLuftfeuchtigkeit = new Chart($("#lineChartLuftfeuchtigkeit"), {
                type: "line",
            data: dataLuftfeuchtigkeit,
            options: optionsLuftfeuchtigkeit
            });
    }

     function temperaturDiagramm() {

        var temperaturWerteTagAktuell = JSON.parse('@Html.Raw(ViewBag.temperaturWerteTagAktuell)');

        dataTemperatur = {
            labels: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23'],
                datasets: [
                    {
                        label: "Temperatur aktuell",
                        data: temperaturWerteTagAktuell,
                        fill: false,
                        borderColor: "rgb(13, 13, 13)",
                        tension: 0.2
                    },
                    {
                        label: "Temperaturgrenze",
                        data: ["25", "25", "25", "25", "25", "25", "25", "25", "25", "25", "25", "25", "25", "25", "25", "25", "25", "25", "25", "25", "25", "25", "25", "25"],
                        fill: true,
                        borderColor: "rgb(240, 2, 2)",
                        tension: 0.1
                    }
                ]
            };

        optionsTemperatur = {
            responsive: true,
            scales: {
                x: {
                    type: 'linear',
                    position: 'bottom',
                    min: 0,
                    max: 23,
                    title: {
                        display: true,
                        text: 'Uhrzeit'
                    },
                    ticks: {
                        autoSkip: false,
                        stepSize: 1,
                        callback: function (value, index, values) {
                            var label = Math.floor(value); // Ganzzahligen Teil extrahieren
                            var decimal = value % 1; // Dezimalteil extrahieren
                            if (decimal !== 0) {
                                label += decimal.toFixed(3).substring(1); // Dezimalzahl anfügen (ohne das führende 0)
                            }
                            return label;
                        }
                    }
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Temperatur in Grad Celsius'
                    }
                }
            }
            };

         lineChartTemperatur = new Chart($("#lineChartTemperatur"), {
                type: "line",
             data: dataTemperatur,
             options: optionsTemperatur
            });
        }

        function aktualisiereView() {
            $.ajax({
                url: "/Home/GetAmmoniak", // Die URL des Controller-Endpunkts, um die aktualisierten Daten abzurufen
                type: "GET",
                success: function (ammoniakData) {

                    var button = document.getElementById("tagBtnAmmoniak");
                    if (button.classList.contains("active")) {
                        lineChartLuftfeuchtigkeit.data.datasets[0].data = JSON.parse(ammoniakData["ammoniakWerteTagDurchschnitt"]); //Durchschnitt
                        lineChartLuftfeuchtigkeit.data.datasets[1].data = JSON.parse(ammoniakData["ammoniakWerteTagAktuell"]); //Aktuell
                    } else {
                        lineChartLuftfeuchtigkeit.data.datasets[0].data = JSON.parse(ammoniakData["ammoniakWerteWocheDurchschnitt"]); //Durchschnitt
                        lineChartLuftfeuchtigkeit.data.datasets[1].data = JSON.parse(ammoniakData["ammoniakWerteWocheAktuell"]); //Aktuell
                    }

                    // Diagramm neu zeichnen
                    lineChartAmmoniak.update();
                },
                error: function (xhr, status, error) {
                    console.log("Fehler beim Abrufen der Ammoniakdaten:", error);
                }
            });

            $.ajax({
                url: "/Home/GetLuftfeuchtigkeit", // Die URL des Controller-Endpunkts, um die aktualisierten Daten abzurufen
                type: "GET",
                success: function (luftfeuchtigkeitData) {
                    var button = document.getElementById("tagBtnLuftfeuchtigkeit");
                    if (button.classList.contains("active")) {
                        lineChartLuftfeuchtigkeit.data.datasets[0].data = JSON.parse(luftfeuchtigkeitData["luftfeuchtigkeitWerteTagDurchschnitt"]); //Durchschnitt
                        lineChartLuftfeuchtigkeit.data.datasets[1].data = JSON.parse(luftfeuchtigkeitData["luftfeuchtigkeitWerteTagAktuell"]); //Aktuell
                    } else {
                        lineChartLuftfeuchtigkeit.data.datasets[0].data = JSON.parse(luftfeuchtigkeitData["luftfeuchtigkeitWerteWocheDurchschnitt"]); //Durchschnitt
                        lineChartLuftfeuchtigkeit.data.datasets[1].data = JSON.parse(luftfeuchtigkeitData["luftfeuchtigkeitWerteWocheAktuell"]); //Aktuell
                    }

                    // Diagramm neu zeichnen
                    lineChartLuftfeuchtigkeit.update();
                },
                error: function (xhr, status, error) {
                    console.log("Fehler beim Abrufen der Luftfeuchtigkeitdaten:", error);
                }
            });

            $.ajax({
                url: "/Home/GetTemperatur", // Die URL des Controller-Endpunkts, um die aktualisierten Daten abzurufen
                type: "GET",
                success: function (temperaturData) {

                    var button = document.getElementById("tagBtnTemperatur");
                    if (button.classList.contains("active")) {
                        lineChartTemperatur.data.datasets[0].data = JSON.parse(temperaturData["temperaturWerteTagAktuell"]); //Durchschnitt
                    } else {
                        lineChartTemperatur.data.datasets[0].data = JSON.parse(temperaturData["temperaturWerteWocheAktuell"]); //Durchschnitt
                    }

                    // Diagramm neu zeichnen
                    lineChartTemperatur.update();
                },
                error: function (xhr, status, error) {
                    console.log("Fehler beim Abrufen der Temperaturdaten:", error);
                }
            });
    }

    function checkeAktuelleWerte(){

        var ammoniak = parseFloat(document.getElementById("currentValueAmmoniak").innerHTML);
        var luftfeuchtigkeit = parseFloat(document.getElementById("currentValueLuftfeuchtigkeit").innerHTML);
        var temperatur = parseFloat(document.getElementById("currentValueTemperatur").innerHTML);

        var boxAmmoniak = document.querySelector(".current-value-box-ammoniak");
        var boxLuftfeuchtigkeit = document.querySelector(".current-value-box-luftfeuchtigkeit");
        var boxTemperatur = document.querySelector(".current-value-box-temperatur");
        

        if(ammoniak >= 12){
            boxAmmoniak.style.border = "1px solid red";
        } else{
            boxAmmoniak.style.border = "1px solid green";
        }

        if (luftfeuchtigkeit >= 20) {
            boxLuftfeuchtigkeit.style.border = "1px solid red";
        } else {
            boxLuftfeuchtigkeit.style.border = "1px solid green";
        }

        if (temperatur >= 25) {
            boxTemperatur.style.border = "1px solid red";
        } else {
            boxTemperatur.style.border = "1px solid green";
        }    
    }
</script>